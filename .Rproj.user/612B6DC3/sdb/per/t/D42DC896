{
    "collab_server" : "",
    "contents" : "# .libPaths(\"/Library/Frameworks/R.framework/Versions/3.3/Resources/library\")\n# .libPaths(\"/Applications/anaconda/lib/R/library\")\n# .libPaths()\n\n# options( java.parameters = c(\"-Xss2560k\", \"-Xmx2g\") )\n\nrequire(jsonlite)\n# remove.packages(\"mailR\")\n# remove.packages(\"rJava\")\n# options(java.parameters = \"-Xss2560k\")\n# \n# install.packages(\"rJava\", repos=\"http://cran.rstudio.com/\", dependencies = T)\n# install.packages(\"mailR\", repos=\"http://cran.rstudio.com/\", dependencies = T)\n\n\n# require(rJava)\nlibrary(mailR)\n\n# tracking_df <- data.frame(Time = NULL, CEX = NULL, Luno = NULL, ZAR = NULL, Premium = NULL)\n# setwd(\"/Volumes/blakecjdl/DataScienceData/BitcoinArbitrage/BitcoinArbitrageNotification/\")\ntracking_df <- readRDS(\"tracking_df.rds\")\n\nwhile(T){\n  try({\n    CEX_all <- fromJSON(file(\"https://cex.io/api/ticker/BTC/USD\"), simplifyVector = FALSE)\n    CEX_BTClast <- as.numeric(CEX_all$ask, type = \"double\") #changed to ask\n    \n    Luno_all <- fromJSON(file(\"https://api.mybitx.com/api/1/ticker?pair=XBTZAR\"), simplifyVector = FALSE)\n    Luno_BTClast <- as.numeric(Luno_all$bid, type = \"double\") #changed to bid\n    \n    CL_all <- fromJSON(file(\"http://apilayer.net/api/live?access_key=fb4098900a0d9b09598c1895b7cf65bf&currencies=ZAR&format=1\"), simplifyVector = FALSE)\n    # CL_all <- fromJSON(file(\"http://apilayer.net/api/live?access_key=84a64004820f9ade8acd8156431c9917&currencies=ZAR&format=1\"), simplifyVector = FALSE)\n    CL_ZArlast <- as.numeric(CL_all$quotes$USDZAR, type = \"double\")\n    \n    Luno_premium <- (Luno_BTClast / CL_ZArlast) / CEX_BTClast\n    \n    tracking_df <- rbind(tracking_df, data.frame(Time = Sys.time(), CEX = CEX_BTClast, Luno = Luno_BTClast, ZAR = CL_ZArlast, Premium = Luno_premium))\n    # setwd(\"/Volumes/blakecjdl/DataScienceData/BitcoinArbitrage/BitcoinArbitrageNotification/\")\n    saveRDS(tracking_df, \"tracking_df.rds\")\n    \n    if (Luno_premium >= 1.11){\n      \n      # text_to_send <- paste0(\"Arbitrage opp - premium is: \", round(Luno_premium, 4))\n      text_to_send <- paste0(\"Time: \", Sys.time(),\n                             \", Opp, prem: \", round(Luno_premium, 4),\n                             \", CEX: \", round(CEX_BTClast, 2),\n                             \", Luno: \", round(Luno_BTClast, 2),\n                             \", ZAR: \", round(CL_ZArlast, 2),\n                             \", Luno spread: \", round(as.numeric(Luno_all$ask, type = \"double\") - as.numeric(Luno_all$bid, type = \"double\"), 2))\n      \n      send.mail(from = \"blakec.mailr@gmail.com\",\n                to = c(\"blake.rsa@gmail.com\"),\n                replyTo = c(\"blake.rsa@gmail.com\"),\n                subject = \"BTC Arbitrage opportuntity\",\n                body = text_to_send,\n                smtp = list(host.name = \"smtp.gmail.com\", port = 465, user.name = \"blakec.mailr\", passwd = \"*@xPx95RV&p30CLZ\", ssl = TRUE),\n                authenticate = TRUE,\n                send = TRUE)\n      \n      print(paste0(\"Time: \", Sys.time(),\n                   \", Opp, prem: \", round(Luno_premium, 4),\n                   \", CEX: \", round(CEX_BTClast, 2),\n                   \", Luno: \", round(Luno_BTClast, 2),\n                   \", ZAR: \", round(CL_ZArlast, 2),\n                   \", Luno spread: \", round(as.numeric(Luno_all$ask, type = \"double\") - as.numeric(Luno_all$bid, type = \"double\"), 2)))\n    } else {\n      \n      print(paste0(\"Time: \", Sys.time(),\n                   \", No opp, prem: \", round(Luno_premium, 4),\n                   \", CEX: \", round(CEX_BTClast, 2),\n                   \", Luno: \", round(Luno_BTClast, 2),\n                   \", ZAR: \", round(CL_ZArlast, 2),\n                   \", Luno spread: \", round(as.numeric(Luno_all$ask, type = \"double\") - as.numeric(Luno_all$bid, type = \"double\"), 2)))\n    }\n  }, silent = TRUE)\n  Sys.sleep(1800)\n  \n}\n\n\n\n# quit(save = \"no\")\n",
    "created" : 1510740710246.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1610964871",
    "id" : "D42DC896",
    "lastKnownWriteTime" : 1510682365,
    "last_content_update" : 1510682365,
    "path" : "~/Documents/BitcoinArbitrage/BitcoinArbitrageNotification/170918_ArbitrageEmail.R",
    "project_path" : "170918_ArbitrageEmail.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}